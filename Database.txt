-- Create the database
CREATE DATABASE IF NOT EXISTS ticket_booking_db;

-- Use the database
USE ticket_booking_db;

-- Create the Bus table
CREATE TABLE IF NOT EXISTS Bus (
    BusID INT PRIMARY KEY AUTO_INCREMENT,
    NumberPlate VARCHAR(15) UNIQUE,
    NumberOfSeats INT
);

-- Create the Route table
CREATE TABLE IF NOT EXISTS Route (
    RouteID INT PRIMARY KEY AUTO_INCREMENT,
    StartLocation VARCHAR(50),
    EndLocation VARCHAR(50)
);

-- Create the Trip table with the additional Price column
CREATE TABLE IF NOT EXISTS Trip (
    TripID INT PRIMARY KEY AUTO_INCREMENT,
    BusID INT,
    RouteID INT,
    StartTime TIMESTAMP,
    EndTime TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    Price DECIMAL(10, 2),
    FOREIGN KEY (BusID) REFERENCES Bus(BusID),
    FOREIGN KEY (RouteID) REFERENCES Route(RouteID)
);

-- Create the DiscountPass table
CREATE TABLE IF NOT EXISTS DiscountPass (
    DiscountPassID INT PRIMARY KEY AUTO_INCREMENT,
    PassName VARCHAR(30),
    DiscountPercentage FLOAT
);

-- Create the Passenger table
CREATE TABLE IF NOT EXISTS Passenger (
    PassengerID INT PRIMARY KEY AUTO_INCREMENT,
    PassengerName VARCHAR(30) UNIQUE,
    PassengerNumber CHAR(10),
    PassengerEmail VARCHAR(20),
    PassengerDOB DATE,
    DiscountPassID INT,
    FOREIGN KEY (DiscountPassID) REFERENCES DiscountPass(DiscountPassID)
);

-- Create the Customer table
CREATE TABLE IF NOT EXISTS Customer (
    CustomerID INT PRIMARY KEY AUTO_INCREMENT,
    CustomerName VARCHAR(30),
    CustomerNumber CHAR(10),
    CustomerEmail VARCHAR(20),
    CustomerDOB DATE,
    Password VARCHAR(15),
    DiscountPassID INT,
    FOREIGN KEY (DiscountPassID) REFERENCES DiscountPass(DiscountPassID)
);

-- Create the Ticket table
CREATE TABLE IF NOT EXISTS Ticket (
    TicketID INT PRIMARY KEY AUTO_INCREMENT,
    TripID INT,
    BookedBy INT,
    BookedFor INT,
    BookTime TIMESTAMP,
    FOREIGN KEY (TripID) REFERENCES Trip(TripID),
    FOREIGN KEY (BookedBy) REFERENCES Customer(CustomerID),
    FOREIGN KEY (BookedFor) REFERENCES Passenger(PassengerID)
);

-- Views

-- View to get all BusID
CREATE VIEW AllBusIDs AS 
SELECT BusID FROM Bus;

-- View to get all RouteID
CREATE VIEW AllRouteIDs AS 
SELECT RouteID FROM Route;

-- View to get all DiscountPassID
CREATE VIEW AllDiscountPassIDs AS 
SELECT DiscountPassID FROM DiscountPass;

--View to get all Bus
CREATE VIEW AllBus AS 
SELECT * FROM Bus;

--View to get all Route
CREATE VIEW AllRoute AS 
SELECT * FROM Route;

--View to get all DiscountPass
CREATE VIEW AllDiscountPass AS 
SELECT * FROM DiscountPass;
